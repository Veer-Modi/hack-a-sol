TESTING CHECKLIST FOR RURALLEARN BACKEND
==========================================

## 1. Unit Tests for Controllers

### Auth Controller
- [x] Signup with valid data
- [x] Signup with duplicate email (409 error)
- [x] Signup with invalid email format (400 error)
- [x] Signup with weak password (400 error)
- [x] Login with valid credentials
- [x] Login with invalid credentials (401 error)
- [x] Refresh token with valid token
- [x] Refresh token with invalid token (401 error)
- [x] Token rotation on refresh
- [x] Prevent refresh token reuse
- [x] Rate limiting on signup (429 after 5 attempts)
- [x] Rate limiting on login (429 after 5 attempts)

### Student Profile Controller
- [ ] Get student profile (authenticated)
- [ ] Get student profile (unauthenticated - 401)
- [ ] Update profile with valid data
- [ ] Update profile with invalid fields (400 error)
- [ ] Update language preference
- [ ] Update learning profile

### Roadmap Controller
- [ ] Generate roadmap with valid inputs
- [ ] Generate roadmap with missing subject (400)
- [ ] Generate roadmap with invalid level (400)
- [ ] Validate roadmap structure (5-12 topics)
- [ ] Check roadmap ownership

### Quiz Controller
- [ ] Generate quiz with valid topic
- [ ] Generate quiz with invalid difficulty (400)
- [ ] Submit quiz answers
- [ ] Prevent duplicate quiz submission (409)
- [ ] Calculate score correctly
- [ ] Generate remediation based on performance

### Mock Test Controller
- [ ] Create mock test with valid data
- [ ] Start test session
- [ ] Track infractions (tab switch, blur)
- [ ] Auto-submit after infraction threshold
- [ ] Submit test answers
- [ ] Prevent submission in non-running state
- [ ] Calculate percentile and predictions

## 2. Integration Tests

### Job Worker Flows
- [ ] Lesson generation job (YouTube transcript)
- [ ] Lesson generation job (text input)
- [ ] PDF generation from lesson content
- [ ] Remediation plan generation
- [ ] Career path generation
- [ ] Job retry on failure
- [ ] Job failure handling

### AI Service Integration
- [ ] Gemini API call with valid prompts
- [ ] JSON response validation
- [ ] Cache hit/miss tracking
- [ ] Error handling for AI failures
- [ ] Latency tracking
- [ ] Rate limiting for AI calls

### Database Operations
- [ ] User creation and retrieval
- [ ] Roadmap save and query
- [ ] Quiz save and query
- [ ] Attempt save and aggregation
- [ ] Test session state transitions
- [ ] Index performance

## 3. End-to-End Tests

### Quiz Generation → Attempt → Analysis Flow
- [ ] Student generates quiz for a topic
- [ ] Student submits quiz answers
- [ ] System calculates score
- [ ] System generates remediation plan
- [ ] Student views remediation
- [ ] System updates progress metrics

### Mock Test Full Flow
- [ ] Student creates mock test
- [ ] Student starts test session
- [ ] Anti-cheat tracking (infractions)
- [ ] Student submits test
- [ ] System grades and analyzes
- [ ] System provides predictions
- [ ] Student views detailed results

### Learning Path Flow
- [ ] Student generates roadmap
- [ ] Student generates lesson for topic
- [ ] Student takes quiz on topic
- [ ] System tracks mastery
- [ ] System suggests next steps

## 4. Security Tests

### CSRF Protection
- [ ] Protected routes require auth header
- [ ] Invalid auth header rejected
- [ ] Missing auth header rejected

### Token Replay Prevention
- [ ] Expired tokens rejected
- [ ] Tampered tokens rejected
- [ ] Tokens with wrong signature rejected
- [ ] Refresh token reuse prevented
- [ ] Concurrent refresh token use prevented

### JWT Misuse
- [ ] Invalid JWT format rejected
- [ ] Malformed JWT rejected
- [ ] JWT with no signature rejected
- [ ] JWT role escalation prevented

### Input Validation
- [ ] SQL injection prevented
- [ ] NoSQL injection prevented
- [ ] XSS attempts sanitized
- [ ] Command injection prevented

### Authorization
- [ ] User can only access own data
- [ ] Student cannot access teacher routes
- [ ] Unauthenticated requests blocked

### Rate Limiting
- [ ] Login brute force prevented
- [ ] Signup spam prevented
- [ ] API abuse prevented

## 5. Performance Tests

### API Response Times
- [ ] Auth endpoints < 200ms
- [ ] Student profile < 100ms
- [ ] Quiz generation < 2s
- [ ] Mock test creation < 3s

### Database Queries
- [ ] User lookup by email < 50ms
- [ ] Attempt aggregation < 500ms
- [ ] Progress calculation < 200ms

### AI Service
- [ ] Gemini API calls < 3s avg
- [ ] Cache hit rate > 30%
- [ ] Error rate < 5%

## 6. Observability Tests

### Metrics Collection
- [ ] API request count tracked
- [ ] Error rates calculated
- [ ] Response times recorded
- [ ] AI call latency tracked
- [ ] Cache hit rate tracked
- [ ] Job queue depth monitored
- [ ] Anti-cheat metrics logged

### Health Checks
- [ ] /api/metrics/health returns status
- [ ] Degraded status on high error rate
- [ ] Unhealthy status on service failure

## 7. Edge Cases & Error Handling

### Network Errors
- [ ] Database connection failure
- [ ] Gemini API timeout
- [ ] Redis connection failure

### Data Validation
- [ ] Empty request bodies
- [ ] Null values in required fields
- [ ] Extremely large payloads
- [ ] Special characters in inputs

### Concurrency
- [ ] Simultaneous quiz submissions
- [ ] Parallel refresh token requests
- [ ] Race conditions in test sessions

## Test Commands

Run all tests:
  npm test

Run tests in watch mode:
  npm run test:watch

Run tests with coverage:
  npm run test:coverage

Run specific test file:
  npm test -- auth.test.js

Run specific test suite:
  npm test -- --testNamePattern="Auth Controller"
